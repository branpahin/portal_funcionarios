<ion-header>
  <ion-toolbar>
    <ion-title>
      <div class="responsive-title">Registro de Usuario</div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrarModal()" fill="clear" style="color:white">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="empleadoForm" (ngSubmit)="guardarUsuario()">

    <ion-grid>
      <ion-row>
        <ion-col>
          <h3 class="subtitulos">Información</h3>
        </ion-col>
      </ion-row>

      <!-- Sección 1: Datos básicos -->
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-item (click)="abrirSelectorCedula()">
            <ion-label position="floating">Cédula</ion-label>
            <ion-input formControlName="IDENTIFICACION" readonly placeholder="Seleccione una cédula"></ion-input>
          </ion-item>
          <app-error-mensaje [control]="empleadoForm.get('IDENTIFICACION')"></app-error-mensaje>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-item>
            <ion-select label="Ciudad de Trabajo" label-placement="floating" 
              formControlName="CIUDAD" multiple="true" (click)="selec('ciudadTrabajo')">
              <ion-select-option *ngFor="let nivel of ciudadTrabajo" [value]="+nivel.id">
                {{ nivel.descripcion }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <app-error-mensaje [control]="empleadoForm.get('CIUDAD')"></app-error-mensaje>
        </ion-col>
      </ion-row>

      <!-- Sección 2: Nombre y Apellido -->
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-item>
            <ion-input [(ngModel)]="nombre" [ngModelOptions]="{ standalone: true }" 
              name="nombre" label="Nombre" labelPlacement="floating"></ion-input>
          </ion-item>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-item>
            <ion-input [(ngModel)]="apellido" [ngModelOptions]="{ standalone: true }" 
              name="apellido" label="Apellido" labelPlacement="floating"></ion-input>
          </ion-item>
        </ion-col>
      </ion-row>

      <!-- Sección 3: Empresa y Roles -->
      <ion-row>
        <ion-col size="12" size-md="4">
          <ion-item>
            <ion-select label="Empresa" label-placement="floating" formControlName="ID_EMPRESA" (click)="selec('empresas')">
              <ion-select-option *ngFor="let nivel of empresas" [value]="+nivel.id">
                {{ nivel.descripcion }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <app-error-mensaje [control]="empleadoForm.get('ID_EMPRESA')"></app-error-mensaje>
        </ion-col>

        <ion-col size="12" size-md="4">
          <ion-item>
            <ion-select label="Rol" label-placement="floating" formControlName="ROL" multiple="true" (click)="selec('roles_Usuario')">
              <ion-select-option *ngFor="let nivel of roles_Usuario" [value]="+nivel.id">
                {{ nivel.descripcion }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <app-error-mensaje [control]="empleadoForm.get('ROL')"></app-error-mensaje>
        </ion-col>

        <ion-col size="12" size-md="4">
          <ion-item>
            <ion-select label="Permisos de Proceso" label-placement="floating" 
              formControlName="ESTADO_PROCESO" multiple="true" (click)="selec('estados_Proceso')">
              <ion-select-option *ngFor="let nivel of estados_Proceso" [value]="+nivel.id">
                {{ nivel.descripcion }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <app-error-mensaje [control]="empleadoForm.get('ESTADO_PROCESO')"></app-error-mensaje>
        </ion-col>
      </ion-row>

      <!-- Sección 4: Contraseña (solo para nuevo usuario) -->
      <ion-row *ngIf="!editar">
        <ion-col size="12" size-md="6">
          <ion-item>
            <ion-input formControlName="CLAVE" name="contraseña" 
              label="Contraseña" labelPlacement="floating" type="password"></ion-input>
          </ion-item>
          <app-error-mensaje [control]="empleadoForm.get('CLAVE')"></app-error-mensaje>
        </ion-col>
      </ion-row>
    </ion-grid>
  </form>
</ion-content>

<ion-footer>
  <ion-toolbar class="btn" color="medium">
    <ion-button *ngIf="permisosService.puedeGrabar()" style="margin-right: 2%;"  (click)="guardarUsuario()">Guardar</ion-button>
  </ion-toolbar>
</ion-footer>